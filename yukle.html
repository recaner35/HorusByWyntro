<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Horus by Wyntro – Installer</title>

<script type="module"
  src="https://unpkg.com/esp-web-tools@9/dist/web/install-button.js">
</script>

<style>
body { background:#0f1115; color:#eaeaea; font-family:sans-serif; }
.container { max-width:420px; margin:80px auto; text-align:center; }
button { width:100%; padding:12px; margin:8px 0; border-radius:6px; border:none; }
.primary { background:#4caf50; }
.danger { background:#f44336; color:#fff; }
pre { background:#000; color:#0f0; padding:10px; height:180px; overflow:auto; }
</style>
</head>

<body>
<div class="container">
  <h2>Horus by Wyntro</h2>

  <esp-web-install-button id="install">
    <button class="primary">Firmware Yükle</button>
  </esp-web-install-button>

  <button id="erase" class="danger">Manuel Flash Erase</button>

  <pre id="log"></pre>
</div>

<script type="module">
const logEl = document.getElementById("log");
const log = m => { logEl.textContent += m + "\n"; };

async function prepareManifest() {
  log("version.json okunuyor...");

  const res = await fetch("version.json");
  const data = await res.json();

  const factoryUrl = data.url.replace(
    "HorusByWyntro.ino.bin",
    "HorusByWyntro-factory.bin"
  );

  log("Sürüm: " + data.version);
  log("Factory: " + factoryUrl);

  const manifest = {
    name: "Horus by Wyntro",
    version: data.version,
    new_install_prompt_erase: true,
    builds: [{
      chipFamily: "ESP32",
      parts: [{ path: factoryUrl, offset: 0 }]
    }]
  };

  const blob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
  document.getElementById("install")
    .setAttribute("manifest", URL.createObjectURL(blob));

  log("Installer hazır.");
}

prepareManifest();

/* MANUEL ERASE – ESP WEB TOOLS DIŞI */
document.getElementById("erase").onclick = async () => {
  log("Manuel erase için ESP Web Tools içindeki erase'i kullanma!");
  log("Bu buton sadece servis içindir.");
};
</script>

</body>
</html>
